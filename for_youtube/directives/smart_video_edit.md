# Video Editing Directive

Automatically edit talking-head videos: remove silences, enhance audio, add swivel teaser, and optionally upload to YouTube.

---

## Recommended Workflow (VAD + Swivel Teaser)

The best quality workflow uses neural voice activity detection for silence removal, then adds a swivel teaser preview.

### When User Says "Edit X Video"

1. Run Step 1 (VAD silence removal) on the input video
2. Run Step 2 (swivel teaser) on the edited output
3. Open the final video for user review

**Background image:** Use `.tmp/bg.png` if it exists, otherwise omit `--bg-image` (uses solid gray).

### Quick Start

**IMPORTANT: Always use the parallel version (`jump_cut_vad_parallel.py`) - it's 5-10x faster.**

```bash
# Step 1: Remove silences + enhance audio (PARALLEL version)
python3 execution/jump_cut_vad_parallel.py input.mp4 .tmp/edited.mp4 --enhance-audio

# Step 2: Add swivel teaser at 3 seconds (previews content from 1:00 onwards)
python3 execution/insert_3d_transition.py .tmp/edited.mp4 output.mp4 \
    --bg-image .tmp/background.png
```

### One-liner

```bash
python3 execution/jump_cut_vad_parallel.py input.mp4 .tmp/edited.mp4 --enhance-audio && \
python3 execution/insert_3d_transition.py .tmp/edited.mp4 output.mp4 --bg-image .tmp/bg.png
```

### What This Produces

| Step | Tool | Result |
|------|------|--------|
| 1 | `jump_cut_vad_parallel.py` | Silences removed via neural VAD, audio enhanced (EQ, compression, -16 LUFS) |
| 2 | `insert_3d_transition.py` | 5-second swivel teaser inserted at 3s, previewing content from 1:00 onwards |

**Timeline:**
```
[0-3s intro] [3-8s swivel teaser @ 60x] [8s onwards: edited content]
Audio: Original audio plays continuously throughout
```

### Full Options

```bash
# With "cut cut" restart detection (removes mistakes)
python3 execution/jump_cut_vad_parallel.py input.mp4 .tmp/edited.mp4 \
    --enhance-audio --detect-restarts

# With LUT color grading
python3 execution/jump_cut_vad_parallel.py input.mp4 .tmp/edited.mp4 \
    --enhance-audio --apply-lut .tmp/cinematic.cube

# Custom swivel teaser timing
python3 execution/insert_3d_transition.py .tmp/edited.mp4 output.mp4 \
    --insert-at 5 --duration 3 --teaser-start 90 --bg-image .tmp/bg.png
```

See `directives/jump_cut_vad.md` and `directives/pan_3d_transition.md` for full documentation.

---

## Alternative: Simple FFmpeg Workflow

For simpler needs, use the FFmpeg-based workflow with Auphonic upload.

### Execution Script

`execution/simple_video_edit.py`

### Workflow

**Always run local-first.** Never ask user whether to upload—just edit locally, present result, then upload when confirmed.

1. Run with `--no-upload` first
2. Present the edited video and metadata to user
3. Only upload via Auphonic after user confirms

```bash
# Step 1: Edit locally (always do this first)
python3 execution/simple_video_edit.py \
    --video .tmp/my_video.mp4 \
    --title "My Video Title" \
    --no-upload

# Step 2: After user confirms, upload
python3 execution/simple_video_edit.py \
    --video .tmp/my_video_edited.mp4 \
    --title "My Video Title" \
    --skip-edit  # TODO: add this flag to skip re-editing

# With thumbnail
python3 execution/simple_video_edit.py \
    --video .tmp/my_video.mp4 \
    --title "My Video" \
    --thumbnail .tmp/thumb.jpg \
    --no-upload
```

Output:
- Edited video: `.tmp/{original_name}_edited.mp4`
- Metadata file: `.tmp/{original_name}_metadata.txt`

---

## What It Does (Pipeline)

1. **Silence Detection** - FFmpeg detects silences ≥3s at -35dB
2. **Silence Removal** - Cuts all detected silences (no AI decisions)
3. **Audio Normalization** - EBU R128 (-16 LUFS) + 80Hz highpass
4. **Transcription** - Whisper transcribes for metadata generation
5. **Metadata Generation** - Claude generates summary + chapters (saved to file)
6. **Auphonic Upload** - Uploads to Auphonic → YouTube as private draft

---

## CLI Arguments

| Argument | Default | Description |
|----------|---------|-------------|
| `--video` | required | Path to input video |
| `--title` | required | YouTube title |
| `--thumbnail` | none | Thumbnail image path |
| `--no-upload` | false | Skip Auphonic, keep local file |
| `--no-normalize` | false | Skip audio normalization |
| `--keep-temp` | false | Don't delete edited video after upload |
| `--silence-threshold` | -35 | dB threshold for silence detection |
| `--silence-duration` | 3.0 | Minimum silence duration (seconds) |

---

## Metadata Output

The script generates a metadata file at `.tmp/{video_name}_metadata.txt` containing:

```
TITLE:
My Video Title

SUMMARY:
This video covers... [2-4 sentences generated by Claude]

CHAPTERS:
00:00:00 Introduction
00:02:30 First Topic
00:05:15 Second Topic
...
```

Timestamps are automatically adjusted for removed content.

---

## Technical Details

### Silence Detection
- FFmpeg `silencedetect` filter
- Default: -35dB threshold, 3s minimum duration (stricter to filter out breathing)
- All detected silences are cut (no AI filtering)

### Audio Normalization
```
highpass=f=80,loudnorm=I=-16:TP=-1.5:LRA=11
```

| Parameter | Value | Purpose |
|-----------|-------|---------|
| `highpass=f=80` | 80Hz | Remove low-frequency rumble |
| `I=-16` | -16 LUFS | YouTube loudness standard |
| `TP=-1.5` | -1.5 dBTP | True peak limit |
| `LRA=11` | 11 LU | Loudness range |

### Video Encoding
- macOS: Hardware encoding (h264_videotoolbox) at 8Mbps
- Fallback: libx264 CRF 18
- Audio: AAC 320kbps

---

## Recording Workflow

1. **Start recording** (1-3s silent intro is fine)
2. **Speak content** with natural pauses
3. **Long pause (3+ seconds)** = will be cut
4. **Stop recording**

If you make a mistake, just pause 3+ seconds and redo. The silence will be removed.

---

## Dependencies

```bash
pip install anthropic faster-whisper python-dotenv requests
brew install ffmpeg  # macOS
```

### Environment Variables (`.env`)

```
ANTHROPIC_API_KEY=sk-ant-...
AUPHONIC_API_KEY=...
```

### Hardcoded Values

```python
AUPHONIC_PRESET_UUID = "8YdWMdfF2QXpdZ2mDuUugj"
YOUTUBE_SERVICE_UUID = "bkVnnU8ziaaHjRckFz9XAT"  # Nick Saraev channel
```

---

## Example Output

```
Analyzing: .tmp/recording.mp4
Duration: 300.0s (5.0 min)

Detecting silence (threshold: -30dB, min: 3.0s)...
Found 4 silent sections (45.2s total)
Keeping 254.8s, removing 45.2s (15.1%)

Processing video...
FFmpeg processing took 12.3s
Edited video: .tmp/recording_edited.mp4

Generating metadata...
Transcription complete: 412 words in 8.2s
Generating metadata with Claude...
Metadata saved to: .tmp/recording_metadata.txt

Uploading to Auphonic...
Production started!
Monitor at: https://auphonic.com/engine/status/...

Done! Video will upload to YouTube as private draft.
Metadata at: .tmp/recording_metadata.txt
```

---

## Troubleshooting

### Audio too quiet
Run without `--no-normalize` to apply EBU R128 normalization.

### Cuts feel abrupt
Increase `--silence-duration` to only cut longer pauses (e.g., `--silence-duration 5`).

### Too much content being cut
Raise threshold: `--silence-threshold -40` (more negative = quieter sounds needed to trigger).

### Breathing sounds kept as pauses
The default -35dB should handle most breathing. If not, try `--silence-threshold -30` (less negative = louder sounds still count as silence).

### Hardware encoding fails
Script automatically falls back to software encoding (libx264).

---

## Related Tools

### Jump Cut Editor (VAD-based) - `execution/jump_cut_vad_parallel.py`
More accurate silence removal using neural voice activity detection (Silero VAD). Better than FFmpeg for detecting actual speech vs. background noise. **Always use the parallel version for 5-10x faster processing.**

```bash
# Basic usage
python3 execution/jump_cut_vad_parallel.py input.mp4 output.mp4

# With audio enhancement and LUT color grading
python3 execution/jump_cut_vad_parallel.py input.mp4 output.mp4 \
    --enhance-audio --apply-lut .tmp/cinematic.cube
```

### 3D Pan Transition - `execution/pan_3d_transition.py`
Create fast-forward "preview" transitions with 3D rotation effects. See `directives/pan_3d_transition.md`.

```bash
# Create intro transition
python3 execution/pan_3d_transition.py input.mp4 .tmp/intro.mp4 \
    --output-duration 3 --bg-image .tmp/background.png
```
